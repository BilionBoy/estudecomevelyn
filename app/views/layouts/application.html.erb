<!DOCTYPE html>
<html lang="pt">
  <head>
    <title>Template</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!-- Metadados  -->
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <!-- Bootstrap, Lucide Icons e Google Fonts -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://unpkg.com/lucide-static@0.344.0/font/lucide.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <% # Dependências CSS %>
    <%= stylesheet_link_tag "admin", "data-turbo-track": "reload" %>
    <% # App JS do projeto %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true %>
  </head>
  <body>
    <!-- Overlay para o sidebar em dispositivos móveis -->
    <div id="sidebar-overlay"></div>
    <!-- Tooltip para dispositivos móveis -->
    <div id="mobile-tooltip" class="mobile-tooltip"></div>
    <div class="admin-layout">
      <!-- Sidebar -->
      <%= render "shared/sidebar" %>
      <!-- Main Content -->
      <main class="main-content">
        <!-- Header/Navbar -->
        <%= render "shared/navbar" %>
        <!-- Content -->
        <div class="content">
          <%= yield %>
        </div>
      </main>
    </div>
    <!-- JavaScript for sidebar functionality -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Elements
        const sidebar = document.getElementById("sidebar");
        const sidebarToggle = document.getElementById("sidebar-toggle");
        const mobileToggle = document.getElementById("mobile-toggle");
        const sidebarOverlay = document.getElementById("sidebar-overlay");
        const mobileTooltip = document.getElementById("mobile-tooltip");

        // Função para salvar o estado do sidebar no localStorage
        function saveSidebarState(isCollapsed) {
          localStorage.setItem("sidebarCollapsed", isCollapsed.toString());
        }

        // Função para obter o estado salvo do sidebar
        function getSavedSidebarState() {
          return localStorage.getItem("sidebarCollapsed") === "true";
        }

        // Toggle sidebar com persistência
        function toggleSidebar() {
          sidebar.classList.toggle("collapsed");
          sidebarOverlay.classList.toggle("active");
          document.body.style.overflow = sidebar.classList.contains("collapsed")
            ? "auto"
            : "hidden";
          saveSidebarState(sidebar.classList.contains("collapsed"));
        }

        // Event listeners
        if (sidebarToggle) {
          sidebarToggle.addEventListener("click", toggleSidebar);
        }

        if (mobileToggle) {
          mobileToggle.addEventListener("click", toggleSidebar);
        }

        if (sidebarOverlay) {
          sidebarOverlay.addEventListener("click", toggleSidebar);
        }

        // Mobile tooltip for sidebar items
        const sidebarLinks = document.querySelectorAll(".sidebar-menu-link");
        if (window.innerWidth < 992) {
          sidebarLinks.forEach((link) => {
            link.addEventListener("click", function () {
              const tooltipText = this.getAttribute("data-tooltip");
              if (mobileTooltip) {
                mobileTooltip.textContent = tooltipText;
                mobileTooltip.style.display = "block";

                setTimeout(() => {
                  mobileTooltip.style.display = "none";
                }, 2000);
              }
              toggleSidebar();
            });
          });
        }

        // Initialize sidebar state based on saved state and screen size
        if (sidebar) {
          const savedState = getSavedSidebarState();
          if (savedState !== null) {
            if (savedState) {
              sidebar.classList.add("collapsed");
            } else {
              sidebar.classList.remove("collapsed");
            }

            if (window.innerWidth < 992 && !savedState) {
              sidebarOverlay.classList.add("active");
              document.body.style.overflow = "hidden";
            }
          } else {
            if (window.innerWidth < 992) {
              sidebar.classList.add("collapsed");
              saveSidebarState(true);
            } else {
              sidebar.classList.remove("collapsed");
              saveSidebarState(false);
            }
          }
        }
      });
    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>